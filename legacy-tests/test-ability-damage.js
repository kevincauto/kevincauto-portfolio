const fs = require('fs');

// Read the log file
const logContent = `|j|☆Bilbo Bogtrotter |j|☆Kaiser Cauto Test |t:|1752097504 |gametype|singles |player|p1|Bilbo Bogtrotter|265| |player|p2|Kaiser Cauto Test|koga-gen3| |gen|6 |tier|\[Gen 6\] OU |rule|Sleep Clause Mod: Limit one foe put to sleep |rule|Species Clause: Limit one of each Pokémon |rule|OHKO Clause: OHKO moves are banned |rule|Moody Clause: Moody is banned |rule|Evasion Items Clause: Evasion items are banned |rule|Evasion Moves Clause: Evasion moves are banned |rule|Endless Battle Clause: Forcing endless battles is banned |rule|HP Percentage Mod: HP is shown in percentages |rule|Swagger Clause: Swagger is banned |clearpoke |poke|p1|Amoonguss, F|item |poke|p1|Ferrothorn, M|item |poke|p1|Hippowdon, F|item |poke|p1|Slowbro, M|item |poke|p1|Azumarill, F|item |poke|p1|Azelf|item |poke|p2|Machamp, M|item |poke|p2|Bisharp, F|item |poke|p2|Latios, M|item |poke|p2|Sableye, F|item |poke|p2|Chansey, F|item |poke|p2|Garchomp, M|item |teampreview | |t:|1752097524 |teamsize|p1|6 |teamsize|p2|6 |start |switch|p1a: Azelf|Azelf|100/100 |switch|p2a: Garchomp|Garchomp, M|100/100 |turn|1 | |t:|1752097545 |move|p1a: Azelf|Taunt|p2a: Garchomp |-start|p2a: Garchomp|move: Taunt |move|p2a: Garchomp|Dragon Tail|p1a: Azelf |-damage|p1a: Azelf|68/100 |drag|p1a: Amoonguss|Amoonguss, F|100/100 | |upkeep |turn|2 | |t:|1752097565 |switch|p1a: Hippowdon|Hippowdon, F|100/100 |-weather|Sandstorm|\[from\] ability: Sand Stream|\[of\] p1a: Hippowdon |move|p2a: Garchomp|Fire Blast|p1a: Hippowdon|\[miss\] |-miss|p2a: Garchomp|p1a: Hippowdon | |-weather|Sandstorm|\[upkeep\] |upkeep |turn|3 | |t:|1752097580 |switch|p2a: Latios|Latios, M|100/100 |move|p1a: Hippowdon|Stealth Rock|p2a: Latios |-sidestart|p2: Kaiser Cauto Test|move: Stealth Rock | |-weather|Sandstorm|\[upkeep\] |-damage|p2a: Latios|94/100|\[from\] Sandstorm |upkeep |turn|4 | |t:|1752097597 |switch|p1a: Azumarill|Azumarill, F|100/100 |move|p2a: Latios|Draco Meteor|p1a: Azumarill |-immune|p1a: Azumarill | |-weather|Sandstorm|\[upkeep\] |-damage|p2a: Latios|88/100|\[from\] Sandstorm |-damage|p1a: Azumarill|94/100|\[from\] Sandstorm |upkeep |turn|5 | |t:|1752097614 |switch|p2a: Sableye|Sableye, F|100/100 |-damage|p2a: Sableye|88/100|\[from\] Stealth Rock |move|p1a: Azumarill|Belly Drum|p1a: Azumarill |-damage|p1a: Azumarill|44/100 |-setboost|p1a: Azumarill|atk|6|\[from\] move: Belly Drum |-enditem|p1a: Azumarill|Sitrus Berry|\[eat\] |-heal|p1a: Azumarill|69/100|\[from\] item: Sitrus Berry | |-weather|Sandstorm|\[upkeep\] |-damage|p1a: Azumarill|63/100|\[from\] Sandstorm |-damage|p2a: Sableye|82/100|\[from\] Sandstorm |-heal|p2a: Sableye|88/100|\[from\] item: Leftovers |upkeep |turn|6 | |t:|1752097632 |move|p2a: Sableye|Will-O-Wisp|p1a: Azumarill |-status|p1a: Azumarill|brn |move|p1a: Azumarill|Play Rough|p2a: Sableye |-supereffective|p2a: Sableye |-damage|p2a: Sableye|0 fnt |faint|p2a: Sableye | |-weather|none |-damage|p1a: Azumarill|51/100 brn|\[from\] brn |upkeep | |t:|1752097649 |switch|p2a: Bisharp|Bisharp, F|100/100 |-damage|p2a: Bisharp|95/100|\[from\] Stealth Rock |turn|7 | |t:|1752097657 |move|p1a: Azumarill|Aqua Jet|p2a: Bisharp |-crit|p2a: Bisharp |-damage|p2a: Bisharp|0 fnt |faint|p2a: Bisharp | |-damage|p1a: Azumarill|39/100 brn|\[from\] brn |upkeep | |t:|1752097667 |switch|p2a: Latios|Latios, M|88/100 |-damage|p2a: Latios|76/100|\[from\] Stealth Rock |turn|8 | |t:|1752097674 |move|p2a: Latios|Psyshock|p1a: Azumarill |-damage|p1a: Azumarill|0 fnt |faint|p1a: Azumarill |-damage|p2a: Latios|66/100|\[from\] item: Life Orb | |upkeep | |t:|1752097695 |switch|p1a: Ferrothorn|Ferrothorn, M|100/100 |turn|9 | |t:|1752097707 |switch|p2a: Franky Jr|Machamp, M|100/100 |-damage|p2a: Franky Jr|94/100|\[from\] Stealth Rock |move|p1a: Ferrothorn|Spikes|p2a: Franky Jr |-sidestart|p2: Kaiser Cauto Test|Spikes | |-status|p2a: Franky Jr|brn|\[from\] item: Flame Orb |upkeep |turn|10 | |t:|1752097723 |move|p2a: Franky Jr|Double-Edge|p1a: Ferrothorn |-resisted|p1a: Ferrothorn |-damage|p1a: Ferrothorn|79/100 |-damage|p2a: Franky Jr|82/100 brn|\[from\] ability: Iron Barbs|\[of\] p1a: Ferrothorn |-damage|p2a: Franky Jr|74/100 brn|\[from\] Recoil |move|p1a: Ferrothorn|Leech Seed|p2a: Franky Jr|\[miss\] |-miss|p1a: Ferrothorn|p2a: Franky Jr |upkeep |turn|11 | |t:|1752097740 |move|p2a: Franky Jr|Double-Edge|p1a: Ferrothorn |-resisted|p1a: Ferrothorn |-damage|p1a: Ferrothorn|62/100 |-damage|p2a: Franky Jr|66/100 brn|\[from\] ability: Iron Barbs|\[of\] p1a: Ferrothorn |-damage|p2a: Franky Jr|58/100 brn|\[from\] Recoil |move|p1a: Ferrothorn|Power Whip|p2a: Franky Jr |-damage|p2a: Franky Jr|0 fnt |faint|p2a: Franky Jr | |upkeep | |t:|1752097755 |switch|p2a: Chansey|Chansey, F|100/100 |-damage|p2a: Chansey|88/100|\[from\] Stealth Rock |-damage|p2a: Chansey|76/100|\[from\] Spikes |move|p1a: Ferrothorn|Leech Seed|p2a: Chansey |upkeep |turn|12 | |t:|1752097768 |move|p2a: Chansey|Seismic Toss|p1a: Ferrothorn |-damage|p1a: Ferrothorn|56/100 |-damage|p2a: Chansey|64/100|\[from\] ability: Iron Barbs|\[of\] p1a: Ferrothorn |move|p1a: Ferrothorn|Power Whip|p2a: Chansey |-damage|p2a: Chansey|38/100 | |-weather|Sandstorm|\[upkeep\] |-damage|p2a: Chansey|32/100|\[from\] Sandstorm |-heal|p1a: Ferrothorn|62/100|\[from\] item: Leftovers |upkeep |turn|13 | |t:|1752097785 |move|p2a: Chansey|Seismic Toss|p1a: Ferrothorn |-damage|p1a: Ferrothorn|50/100 |move|p1a: Ferrothorn|Power Whip|p2a: Chansey |-damage|p2a: Chansey|16/100 | |-weather|Sandstorm|\[upkeep\] |-damage|p2a: Chansey|10/100|\[from\] Sandstorm |-heal|p1a: Ferrothorn|56/100|\[from\] item: Leftovers |upkeep |turn|14 | |t:|1752097802 |move|p2a: Chansey|Seismic Toss|p1a: Ferrothorn |-damage|p1a: Ferrothorn|44/100 |move|p1a: Ferrothorn|Power Whip|p2a: Chansey |-damage|p2a: Chansey|0 fnt |faint|p2a: Chansey | |-weather|Sandstorm|\[upkeep\] |-heal|p1a: Ferrothorn|50/100|\[from\] item: Leftovers |upkeep |turn|15 | |t:|1752097826 |switch|p2a: Garchomp|Garchomp, M|100/100 |-damage|p2a: Garchomp|94/100|\[from\] Stealth Rock |-damage|p2a: Garchomp|82/100|\[from\] Spikes |move|p1a: Ferrothorn|Power Whip|p2a: Garchomp |-damage|p2a: Garchomp|54/100 |-damage|p1a: Ferrothorn|79/100|\[from\] ability: Rough Skin|\[of\] p2a: Garchomp |-damage|p1a: Ferrothorn|62/100|\[from\] item: Rocky Helmet|\[of\] p2a: Garchomp | |-weather|none |-heal|p1a: Ferrothorn|69/100|\[from\] item: Leftovers |upkeep |turn|16 | |t:|1752097845 |move|p1a: Ferrothorn|Power Whip|p2a: Garchomp |-damage|p2a: Garchomp|28/100 |-damage|p1a: Ferrothorn|56/100|\[from\] ability: Rough Skin|\[of\] p2a: Garchomp |-damage|p1a: Ferrothorn|40/100|\[from\] item: Rocky Helmet|\[of\] p2a: Garchomp |move|p2a: Garchomp|Dragon Tail|p1a: Ferrothorn |-resisted|p1a: Ferrothorn |-damage|p1a: Ferrothorn|31/100 |-damage|p2a: Garchomp|16/100|\[from\] ability: Iron Barbs|\[of\] p1a: Ferrothorn |drag|p1a: Amoonguss|Amoonguss, F|100/100 | |upkeep |turn|17 | |t:|1752097862 |move|p2a: Garchomp|Stealth Rock|p1a: Amoonguss |-sidestart|p1: Bilbo Bogtrotter|move: Stealth Rock |move|p1a: Amoonguss|Giga Drain|p2a: Garchomp |-damage|p2a: Garchomp|0 fnt |faint|p2a: Garchomp | |upkeep | |t:|1752097873 |switch|p2a: Chansey|Chansey, F|69/100 |-damage|p2a: Chansey|57/100|\[from\] Stealth Rock |-damage|p2a: Chansey|44/100|\[from\] Spikes |turn|18 | |t:|1752097882 |move|p2a: Chansey|Seismic Toss|p1a: Amoonguss |-damage|p1a: Amoonguss|77/100 |move|p1a: Amoonguss|Giga Drain|p2a: Chansey |-damage|p2a: Chansey|38/100 |-heal|p1a: Amoonguss|82/100|\[from\] drain|\[of\] p2a: Chansey | |-heal|p1a: Amoonguss|88/100|\[from\] item: Black Sludge |upkeep |turn|19 | |t:|1752097895 |switch|p1a: Ferrothorn|Ferrothorn, M|31/100 |-damage|p1a: Ferrothorn|25/100|\[from\] Stealth Rock |move|p2a: Chansey|Seismic Toss|p1a: Ferrothorn |-damage|p1a: Ferrothorn|0 fnt |-damage|p2a: Chansey|26/100|\[from\] ability: Iron Barbs|\[of\] p1a: Ferrothorn |faint|p1a: Ferrothorn | |upkeep | |t:|1752097906 |switch|p1a: Slowbro|Slowbro, M|100/100 |-damage|p1a: Slowbro|88/100|\[from\] Stealth Rock |turn|20 | |t:|1752097914 |move|p2a: Chansey|Seismic Toss|p1a: Slowbro |-damage|p1a: Slowbro|63/100 |move|p1a: Slowbro|Future Sight|p2a: Chansey |-start|p1a: Slowbro|move: Future Sight | |-heal|p1a: Slowbro|69/100|\[from\] item: Leftovers |upkeep |turn|21 | |t:|1752097930 |switch|p1a: Amoonguss|Amoonguss, F|100/100 |-damage|p1a: Amoonguss|88/100|\[from\] Stealth Rock |move|p2a: Chansey|Seismic Toss|p1a: Amoonguss |-damage|p1a: Amoonguss|65/100 | |-heal|p1a: Amoonguss|71/100|\[from\] item: Black Sludge |upkeep |turn|22 | |t:|1752097942 |move|p2a: Chansey|Seismic Toss|p1a: Amoonguss |-damage|p1a: Amoonguss|48/100 |move|p1a: Amoonguss|Giga Drain|p2a: Chansey |-damage|p2a: Chansey|19/100 |-heal|p1a: Amoonguss|53/100|\[from\] drain|\[of\] p2a: Chansey | |-end|p2a: Chansey|move: Future Sight |-damage|p2a: Chansey|8/100 |-heal|p1a: Amoonguss|59/100|\[from\] item: Black Sludge |upkeep |turn|23 | |t:|1752097957 |move|p2a: Chansey|Seismic Toss|p1a: Amoonguss |-damage|p1a: Amoonguss|36/100 |move|p1a: Amoonguss|Giga Drain|p2a: Chansey |-damage|p2a: Chansey|2/100 |-heal|p1a: Amoonguss|40/100|\[from\] drain|\[of\] p2a: Chansey | |-heal|p1a: Amoonguss|46/100|\[from\] item: Black Sludge |upkeep |turn|24 | |t:|1752097966 |move|p2a: Chansey|Seismic Toss|p1a: Amoonguss |-damage|p1a: Amoonguss|23/100 |move|p1a: Amoonguss|Giga Drain|p2a: Chansey |-damage|p2a: Chansey|0 fnt |-heal|p1a: Amoonguss|24/100|\[from\] drain|\[of\] p2a: Chansey |faint|p2a: Chansey | |-heal|p1a: Amoonguss|30/100|\[from\] item: Black Sludge |upkeep | |t:|1752097971 |switch|p2a: Latios|Latios, M|66/100 |-damage|p2a: Latios|54/100|\[from\] Stealth Rock |turn|25 | |t:|1752097978 |switch|p1a: Azelf|Azelf|68/100 |-damage|p1a: Azelf|56/100|\[from\] Stealth Rock |move|p2a: Latios|Recover|p2a: Latios |-heal|p2a: Latios|100/100 | |upkeep |turn|26 | |t:|1752097996 |move|p1a: Azelf|Explosion|p2a: Latios |-damage|p2a: Latios|0 fnt |faint|p1a: Azelf |faint|p2a: Latios | |win|Bilbo Bogtrotter`;

// Split by | to get individual log entries
const entries = logContent.split(' |');

console.log('=== ABILITY/ITEM DAMAGE ENTRIES ===');
entries.forEach((entry, idx) => {
  if (entry.includes('[from] ability:') || entry.includes('[from] item:')) {
    console.log(`Entry ${idx + 1}: |${entry}`);
    
    // Test our regex patterns
    const abilityMatch = entry.match(/\[from\] ability: ([^|]+)\|\[of\] (p\d+a: [^|]+)/);
    const itemMatch = entry.match(/\[from\] item: ([^|]+)\|\[of\] (p\d+a: [^|]+)/);
    
    console.log(`  Ability match:`, abilityMatch);
    console.log(`  Item match:`, itemMatch);
    
    if (abilityMatch) {
      const abilityName = abilityMatch[1].trim();
      const pokemonField = abilityMatch[2];
      const pokemonNick = pokemonField.split(': ')[1].trim();
      console.log(`  Parsed: ${pokemonNick} (${abilityName})`);
    }
    
    if (itemMatch) {
      const itemName = itemMatch[1].trim();
      const pokemonField = itemMatch[2];
      const pokemonNick = pokemonField.split(': ')[1].trim();
      console.log(`  Parsed: ${pokemonNick} (${itemName})`);
    }
    
    console.log('');
  }
});

console.log('=== SUMMARY ===');
console.log('Expected events:');
console.log('- Franky Jr (Machamp) takes Iron Barbs damage from Ferrothorn');
console.log('- Garchomp takes Iron Barbs damage from Ferrothorn');
console.log('- Chansey takes Iron Barbs damage from Ferrothorn');
console.log('- Ferrothorn takes Rough Skin damage from Garchomp (2x)');
console.log('- Ferrothorn takes Rocky Helmet damage from Garchomp (2x)'); 